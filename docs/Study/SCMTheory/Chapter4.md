# 库存管理和风险分担-第一部分

- 在正确的时间、正确的地点拥有正确数量的产品

- 什么是客户服务水平？
    - = 得到服务的客户 / 来到的客户 

- 库存管理为什么重要？
    - 库存周转率 = 销售额 / 平均库存价值，越高越好。美国在8～10%？

- 企业为什么要持有库存？
    - 客户需求的不确定性（竞争产品多、产品生命周期缩短，客户历史数据效用已经过时了）
    - 供应的不确定性（质量、数量、交货时间）
    - 提前期的不确定性
    - 运输公司要实现 **规模经济** 
    - 战略性库存（压货）

- 供应链的特性：客户的需求（D） ｜ 补货提前期（订单发出到收到货物的时间，L） ｜ 不同产品的数量 ｜ 计划期的长度（T）  ｜ 成本（C，订货成本K，库存成本h）。上述即为制定库存策略的外生变量
- 内生变量：什么时候订货？每次定多少货



------------------

## 单级供应链库存控制

- 考虑单级供应链的一个企业

### 经济订货批量模型（EOQ模型）
- 假设：
    - **需求速度恒定的**，每天需求D产品
    - 每个周期内仓库固定订购Q产品
    - 仓库每次订货的固定成本（准备成本）K 
    - 库存持有成本：单位时间内保管每单位库存产生的成本
    - 提前期为0 
    - 初始库存为0
    - 计划周期无限长

- 库存水平 q(t) = Q - Dt 
- 一个周期内库存总成本  $C_T = K + \dfrac{hTQ}{2}$，（可以求积分）
- 单位时间内的总平均成本 $\dfrac{C_T}{T} = \dfrac{K}{T} + \dfrac{hQ}{2}$
- $\dfrac{C_T}{T} = \dfrac{KD}{Q} + \dfrac{hQ}{2}$；（可以求一阶导数）
- 求的 $Q^* = \sqrt{2KD}{h}$
- 总库存成本对订货批量不敏感：即使有一点参数估计的误差也问题不大。


- 需求不确定的影响：
    - 预测总是不准确的
    - 预测的期限越长，误差越大
    - 很难预测对某个单品库存单位（SKU）的需求，而把一个产品系列内所有SKU的总需求会容易很多；

### 随机需求单周期订货模型

- 考虑一种生命周期非常短的产品，需求不确定（报纸、杂志），这也是和EOQ模型的最大区别。
    - 只有一次订货机会
    - 在需求实现之前，公式必须决定订货量以满足需求（供不应求的损失、供过于求的损失）
    - 需求离散的，意味着所给到的信息大致为：

| 预测销售量 | 概率  |
| :--------: | :---: |
|    8000    |  10%  |
|    9000    |  15%  |
|   10000    |  24%  |
|   11000    |  26%  |
|    ...     |  ...  |

- 此时，可以通过如下公式计算，在需求量d_i的情况下，订购Q单位产品的期望收益。：

$$\sum { p_i * [ \min(Q, d_i) * P + \max(Q - d, 0) * S - QV - F  ]}$$

> $P$  为售价，$S$ 为残值，$V$ 为单位订购成本，$F$ 为固定成本

- 最优订货量 / 产量 $\neq$ 期望 / 平均需求

- 比较多卖出一件产品的边际利润和少卖出一产品的平均损失。
    - 边际利润 = 单位产品售价 - 单位可变成本
    - 边际损失 = 单位可变成本 - 单位残值
    - 如果边际利润 > 边际损失，那么最优订货量 > 平均需求
    - 否则，最优订货量 < 平均需求

- **风险和回报的权衡**：
    - 生产少一点和生产多一点，会获得相同的平均利润（9000 和 16000会获得相同的平均利润）
    - 高生产，会有可能获得更多利润。

- 这里可以把平均收益画个图，呈现拱型的。【补充图】
- 总结：
    - 最优订货量不一定等于预测需求或者平均需求
    - 固定成本对最优产量没有影响，但对是否生产有影响
    - 平均利润一般会随着订单量增加而增加，然后再减少
    - 产量增加，风险也会增加，获得较大利润的概率也会增加。


### 单周期连续随机需求模型（报童模型）

- 假设：卖出报纸的数量D是连续型随机变量。概率分布函数$F(\sigma)$。$\sigma$：实际需求量，报童每天买$Q$报纸，进价$c$，零售价$p$，处理价格$s$元。
- 当实际需求 $\sigma \leq Q$ 时，报童获利：$(p - c) \sigma - (c - s)(Q - \sigma)$
- 当实际需求 $\sigma > Q$ 时，报童获利：$(p - c)Q$
- 考虑连续型需求的概率密度 $f(\sigma)$。可以把期望利润写作：

$$\prod{Q} = \int^{Q}_{\sigma = 0}[ (p - c) \sigma - (c - s)(Q - \sigma)] f(\sigma)d\sigma \\+ \int^{+\infty}_{\sigma = Q}[( p - c)Q]f(\sigma) d\sigma$$

> 将上式整理后得：

$$\prod{Q} = (p - c) \int^{Q}_{\sigma = 0} \sigma f(\sigma)d\sigma - (c - s)Q \int^{Q}_{\sigma = 0}f(\sigma) d\sigma + \\ (c - s)\int^{Q}_{\sigma = 0}\sigma f(\sigma)d\sigma + (p - c)Q\int^{+\infty}_{\sigma = Q}f(\sigma)d\sigma$$


### 考虑初始库存的影响

- 是否可以“不生产”
    - 只用手上的库存去满足需求，避免支付固定费用
    - 支付固定费用，从而拥有更多的库存来满足需求


- 滑雪服的案例：
    - 如果什么都不生产，平均利润：原来的情况下的库存的收益 + 生产情况下的成本（因为没生产，把这块加进来）
    - 如果生产，要话费机器开工成本，一下子生产到最高收益为止。可能开销反而更大。

- 那么到底什么时候安排生产呢？有无规律可循？
    - 初始库存低于一个点的时候，决定生产并提升到盈利最高点；
    - 否则不生产



### 多次订货


#### 定期检查策略：(s, S) 策略

1. 每过固定的时间就检查库存水平一次；
2. 每次检查以后确定合适的订购数量；
3. 当频繁地检查库存和下达订单不可行和不便利的时候，这种策略就比较适用。 

- 当库存水平低于特定值 $s$ 时，我们订货（或者生产）以增加库存水平到 $S$。这种策略我们称为最小最大策略。
- 我们称 $s$ 为订货点，$S$ 为最大库存水平。
- s和S之间的差距由订货/生产和运输的固定成本决定。（直接观察图片）


#### 持续检查策略：(Q, R) 策略

- 库存被持续地检查
- 当库存下降到订货点 $R$ 的时候就下达订单，订货量为 $Q$。
- 当库存可以持续检查的时候，这种库存策略最适用。


### 何时订货？


#### (Q,R) 策略下的相关计算
> **需求确定**和**提前期确定**的情况：
- 已知每天的需求恒定为d
- 每次订货，需要l天才能到货；
- 仓库每次订货都会产生一个固定成本K
- 库存持有成本h，单位时间内保管每单位库存产生的成本


> 模型实际上为：一个改进的EOQ模型。
> 订货点：$R = ld$
>
> 订货量$Q^* = \sqrt{\dfrac{2KD}{h}}$；正好到的时候仓库里容量为0


---------

> **随机需求**和**随机提前期**的情况


- 分销商面对每日需求$D_i$是独立、同分布随机变量，$(\mu_D, \sigma_D)$
- 订货提前期L是独立于每日需求D_i的随机变量，$(\mu_L, \sigma_L)$
- 分销商每次向制造商订购产品，需要支付一个固定成本K，加上与订购数量成比例的费用；
- 库存持有成本根据单位时间保管单位库存的费用h计算；
- 如果客户订单到达时，手头无库存满足客户需求，该分销商将失去这笔订单。
- 分销商规定周期服务水平 $\alpha$：(Cycle Service Level)：不出现缺货的概率；
- 安全库存：由于需求和提前期具有随机性，为了防止缺货而保留的高于期望需求的库存（Safety Stock）；

> 我们要求的是 $R$ 和 $Q$ 的值
>
> 提前期L天内的需求 D_L = \sum^{L}_{i=1}D_i。这里的L也是随机变量。本质上是“随机多个天里随机变量的和”
>
> “复合随机变量的性质”  


!!! note
    库存状况 = 仓库中的库存 + 在途库存
          

-----------

#### (s,S) 策略下的相关计算

- 接下来讨论定期检查策略的情况
- 在很多实际中，库存水平的检查时周期性的，间隔是固定的。
- 每次检查后都可能要订购适当的数量
- 两种情况：
    - 检查间隔时间相对很短（1天）：每次检查库存，如果库存状况下降到s以下，就订购足够多的产品使库存状况达到S
    - 检查间隔时间很长（1周或者1月）：
        - 怎么定义“检查时间很长？”：如果你每次检查之后发现都需要订货，那么时间相对就是很长的了；
        - 就需要采用：基本库存水平策略。每次检查库存后，订购足够的货物使库存状况上升到基本库存水平。 
- 第一种情况下：
    -  求s和S的最优值的解析表达式很难，但是容易求一个有效的近似值：先假设为持续检查的情况，计算Q和R。令s = R，S = Q + R
- 第二种情况下：