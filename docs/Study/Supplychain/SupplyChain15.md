# 报童模型 II   

## 考虑数量折扣的报童模型

在供应链采购实际中，常常存在如下情景：对于服装等季节性产品，制造商在订货量超过某个数量后提供价格折扣，在产品生命周期的最后阶段也可能面临这样的情况。产品的未来需求不确定，采购员只有一次订购机会，在确定订货规模的时候，采购员必须考虑数量折扣。

我们考虑如下模型：

某零件零售商在制造商停产某零件前还有一次订货机会，这种零件的单位零售价是$p$，零售商的成本（如果没有折扣）是$c$，残值是$s$。如果零售商订购数量不少于$K$，那么制造商将提供折扣价$c_d$。零售商可以通过如下步骤确定最终订货量。


$$CSL^{*} = P(需求量 \leq O^{*}) = \dfrac{p - c}{p - s} = \dfrac{C_u}{C_o + C_u}  \tag{1}$$

$$ O^{*} = F^{-1}(CSL^{*}, \mu, \sigma) = NORMINV(CSL^{*}, \mu, \sigma) \tag{2}$$

$$Profit = (p-s)\mu NORMDIST(\dfrac{O - \mu}{\sigma}, 0, 0, 1) - $$

$$(p-s)\sigma NORMDIST(\dfrac{O - \mu}{\sigma}, 0, 1, 0) -$$

$$O(c-s)NORMDIST(O,\mu, \sigma, 1) + O(p-c)[1 - NORMDIST(O, \mu, \sigma, 1)] \tag{3}$$

- 1⃣️ 由$C_o = c -s$ 和$C_u = p -c$，借助式(1)和(2) 计算没有折扣的情况下最优周期服务水平 $CSL^{*}$和订货量$O^{*}$。利用(3)计算订货量为$O^{*}$时的预期利润；
- 2⃣️ 由$C_o = c_d -s$ 和$C_u = p -c_d$ ，借助式(1)和(2) 计算有折扣的情况下最优周期服务水平 $CSL^{*}_{d}$和订货量$O^{*}_{d}$。如果$O^{*}_{d} \geq  K$，就利用(3)计算订货量为$O^{*}_d$的预期利润，如果$O^{*}_{d} <  K$，就利用(3)计算订货量为 K的预期利润。
- 3⃣️ 如果第一步计算的利润较高，就订购$O^{*}$单位，如果步骤二利润高，则在$O^{*}_{d} \geq  K$时候订购$O^{*}_d$单位，在$O^{*}_{d} < K$时订购$K$单位。


**案例：**
<font color = Grey>
SparesRUs 需要决定一款零件的订购量。已知需求服从服从正态分布，均值150，标准差40，零售价200，未售出的零件残值为0.制造商给出如下策略：如果订货低于200，则每个装置售价50，如果订购至少200件，则售价45. 问应该订购几个零件？
</font>


------

## 连续补货产品的期望周期服务水平

上一节关注的是只定一次货的情况，这一节考虑更加复杂的情况。比如Walmart订购清洁剂，会在相当长的时间里按照一定的订货周期订购。如果在某个补货周期没有售出，它还可以在下一个补货周期中出售，不必降价处理。然而这种情况下上一个周期未售完的货物会导致库存成本的增加。

我们把模型简化成下面两种极端情况：

1. 产品缺货期间所有的需求都储备起来，在库存得到补充后予以满足；
2. 产品缺货期间所有的需求都丢失；

当然现实运营中的情况往往居于两种情况之间，如果产品缺货，一部分需求会丢失，而另一些顾客愿意等到库存补充之后再度光顾。我们假设单位时间内的需求服从正态分布。已知参数如下：

$Q$ : 补货批量；

$S$ ：与每笔订单相关的固定成本；

$ROP$：再订货点；

$D$：单位时间内的平均需求；

$\sigma$：单位时间内需求的标准差；

$ss$: 安全库存($ss = ROP - D_L$);

$CSL$：周期服务水平；

$C$：单位成本；

$h$：单位时间内库存持有成本占产品成本的比例；

$H$：单位时间内单位产品的库存持有成本；$H = hC$ ;


### 1. 缺货期间所有需求储备起来

由于需求都没有丢失，所以实际上所有的需求始终能得到满足，也就是说成本最小化就意味着利润最大化。Walmart等在实际中会对缺货期间等待，并且在到货后继续购买的顾客提供优惠，折扣价$C_u$。

如果超市经理提高安全库存水平，使得更多的订单可以通过库存解决，从而降低储备订单的数量。我们先考虑补货周期内每多持有一单位安全库存的成本和收益。如果安全库存从$ss$（对应的周期服务水平$CSL$）上升到$ss+1$，供应链要为补货周期内（周期时长$Q/D$)多持有一单位库存而付出成本。如果补货周期内需求超过$ss$（这种概率是($1-CSL$))，那么额外一单位安全库存就是有利的（因为此时有收益，收益是上面说的折扣价$C_u$）。

上述可简记为：
- 额外一单位安全库存在每个补货周期内增加的成本 = $(Q/D)H$；
- 额外一单位安全库存在每个补货周期内的收益 = $(1-CSL)C$;
  
这种情况下最优周期服务水平可以通过令额外成本与收益相等来算出；

$$CSL^{*} = 1 - \left[ \dfrac{HQ}{DC_u} \right]\tag{6}$$

这里可以和安全库存串联起来。给出安全库存水平后，就可以用安全库存中计算安全库存水平的公式计算ss：

$$ss = NORMINV(CSL) \times \sqrt{L} \sigma_D$$

**分析：**

可见，如果超市经理增加补货批量Q，那么周期服务水平降低，从而降低安全库存量。但是这种方法必须谨慎使用，因为订货批量增加会导致周转库存增加。

如果已知库存不足成本C_u,就可以得出适当的周期服务水平，从而得出适当的安全库存量，但是<u>在实际情况下，想要估算库存不足成本很难，</u>。很多时候管理者希望了解当前库存政策下隐含的库存不足成本大概是多少，从而决策应该增加、减少还是维持现有水平。


### 2. 产品缺货期间需求全部损失

此时周期服务水平计算公式：

$$CSL^{*} = 1 - \dfrac{HQ}{HQ+DC}  \tag{7}$$

假设C_u是产品缺货期间丢失的每一单位的成本，对比（6）和（7）式，可知对于相同的库存不足成本，如果需求不是储备起来而是丢失了，那么供应链应该提供更高的CSL。


**案例：**

Walmart超市清洁用品采购案例：需求服从正态分布，均值100，标准差20，补货提前期2周。如果清洁剂的现有库存降低到300，超市会订购400单位，每单位清洁剂的成本3美元，Walmart库存持有成本20%。假设所有未满足需求会储备到下一个周期满足，评估现有政策下的库存不足成本。

延伸：
上述情况不变，只是现在假设缺货期间所有的需求损失，丢失一单位需求的成本为2美元，计算应该设定的最优CSL。

